<div class="employee-dashboard">
  <div *ngIf="isLoading" class="loading-state">
    <mat-spinner diameter="64"></mat-spinner>
    <p>Cargando tu informaci√≥n personal...</p>
  </div>

  <div *ngIf="!isLoading && errorMessage" class="error-state">
    <mat-icon>error</mat-icon>
    <h2>Lo sentimos</h2>
    <p>{{ errorMessage }}</p>
  </div>

  <ng-container *ngIf="!isLoading && !errorMessage">
    <section class="header">
      <div>
        <h1>Hola, {{ collaboratorName }} üëã</h1>
        <p>{{ roleName }} ‚Ä¢ {{ totalTasks }} tareas asignadas</p>
      </div>
    </section>

    <section class="stats-grid">
      <mat-card class="stat-card">
        <div class="icon primary">
          <mat-icon>assignment</mat-icon>
        </div>
        <div class="content">
          <span class="label">Total de tareas</span>
          <span class="value">{{ totalTasks }}</span>
        </div>
      </mat-card>

      <mat-card class="stat-card">
        <div class="icon info">
          <mat-icon>timelapse</mat-icon>
        </div>
        <div class="content">
          <span class="label">En progreso</span>
          <span class="value">{{ inProgressTasks }}</span>
        </div>
      </mat-card>

      <mat-card class="stat-card">
        <div class="icon warning">
          <mat-icon>pending_actions</mat-icon>
        </div>
        <div class="content">
          <span class="label">Sin iniciar</span>
          <span class="value">{{ pendingTasks }}</span>
        </div>
      </mat-card>

      <mat-card class="stat-card">
        <div class="icon success">
          <mat-icon>task_alt</mat-icon>
        </div>
        <div class="content">
          <span class="label">Finalizadas</span>
          <span class="value">{{ completedTasks }}</span>
        </div>
      </mat-card>
    </section>

    <mat-card class="tasks-card" *ngIf="tasks.length > 0; else emptyTasks">
      <mat-card-header>
        <mat-card-title>Mis tareas asignadas</mat-card-title>
        <mat-card-subtitle>Actualiza el estado desde tu dispositivo de trabajo</mat-card-subtitle>
      </mat-card-header>
      <mat-divider></mat-divider>
      <div class="table-wrapper">
        <table mat-table [dataSource]="tasks" class="tasks-table">
          <ng-container matColumnDef="sequence">
            <th mat-header-cell *matHeaderCellDef>#</th>
            <td mat-cell *matCellDef="let task; let i = index">{{ task.sequence || i + 1 }}</td>
          </ng-container>

          <ng-container matColumnDef="product">
            <th mat-header-cell *matHeaderCellDef>Producto</th>
            <td mat-cell *matCellDef="let task">
              <div class="cell-with-icon">
                <mat-icon>checkroom</mat-icon>
                <div>
                  <span class="primary-text">{{ task.product?.name || 'Producto por asignar' }}</span>
                  <span class="secondary-text" *ngIf="task.product?.category_name">
                    {{ task.product?.category_name }}
                  </span>
                </div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="area">
            <th mat-header-cell *matHeaderCellDef>√Årea</th>
            <td mat-cell *matCellDef="let task">{{ task.area?.name || 'Sin √°rea' }}</td>
          </ng-container>

          <ng-container matColumnDef="state">
            <th mat-header-cell *matHeaderCellDef>Estado</th>
            <td mat-cell *matCellDef="let task">
              <mat-chip [ngClass]="getStateClass(task)" matTooltip="{{ task.state?.name || 'Sin estado' }}">
                {{ task.state?.name || 'Sin estado' }}
              </mat-chip>
            </td>
          </ng-container>

          <ng-container matColumnDef="start">
            <th mat-header-cell *matHeaderCellDef>Inicio</th>
            <td mat-cell *matCellDef="let task">
              <ng-container *ngIf="task.start_date; else noStart">
                {{ task.start_date | date: 'dd/MM/yyyy HH:mm' }}
              </ng-container>
              <ng-template #noStart>Sin iniciar</ng-template>
            </td>
          </ng-container>

          <ng-container matColumnDef="end">
            <th mat-header-cell *matHeaderCellDef>Fin</th>
            <td mat-cell *matCellDef="let task">
              <ng-container *ngIf="task.end_date; else noEnd">
                {{ task.end_date | date: 'dd/MM/yyyy HH:mm' }}
              </ng-container>
              <ng-template #noEnd>En curso</ng-template>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns; trackBy: trackTask"></tr>
        </table>
      </div>
    </mat-card>

    <ng-template #emptyTasks>
      <div class="empty-state">
        <mat-icon>celebration</mat-icon>
        <h3>¬°Todo al d√≠a!</h3>
        <p>No tienes tareas asignadas por el momento.</p>
      </div>
    </ng-template>
  </ng-container>
</div>
